<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untiled Site</title>
    <style>
        /* 全体のスタイル */
        body {
            font-family: 'Hiragino Kaku Gothic ProN', 'ヒラギノ角ゴ ProN W3', Meiryo, メイリオ, Osaka, 'MS PGothic', arial, helvetica, sans-serif;
            line-height: 1.5;
            margin: 0;
            padding: 15px;
            background-color: #f0f2f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* ヘッダー */
        header {
            text-align: center;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        h1 {
            color: #212529;
            margin: 0;
            font-size: 1.8em;
        }
        header p {
            color: #6c757d;
            margin-top: 5px;
            font-size: 0.9em;
        }

        /* カードグリッド */
        #formula-grid {
            display: grid;
            /* カードの最小幅を約1/3に調整 (280px -> 180px) */
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        /* カードのスタイル */
        .formula-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
        }
        .formula-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.1);
        }
        .formula-card.active {
            border: 2px solid #e67e22;
            box-shadow: 0 0 8px rgba(230, 126, 34, 0.4);
        }

        /* カード上部 (コンテンツ) */
        .card-content {
            /* パディングと最小高さを調整 */
            padding: 10px;
            flex-grow: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100px;
        }

        /* 星評価 */
        .stars {
            /* サイズと位置を調整 */
            font-size: 12px;
            color: #f1c40f;
            position: absolute;
            top: 8px;
            left: 10px;
            letter-spacing: 1px;
        }
        .stars .dim {
            color: #ced4da;
        }

        /* 公式表示 */
        .formula-display {
            text-align: center;
            /* フォントサイズを調整 */
            font-size: 16px;
            font-weight: bold;
            color: #343a40;
            margin: 15px 0 10px 0;
            padding: 5px;
        }

        /* 補足情報 */
        .formula-info {
            /* フォントサイズを調整 */
            font-size: 10px;
            color: #868e96;
            text-align: center;
            padding: 0 5px;
            line-height: 1.3;
        }

        /* カード下部 (フッター) */
        .card-footer {
            background-color: #3498db;
            color: white;
            text-align: center;
            /* パディングとフォントサイズを調整 */
            padding: 8px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* 問題表示エリア */
        #problem-container {
            margin-top: 15px;
        }
        h2 {
            color: #495057;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 8px;
            font-size: 1.4em;
        }
        .problem-card {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-left: 4px solid #3498db;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* 問題カード内のテキストサイズを調整 */
        .problem-card h3 {
            margin-top: 0;
            color: #212529;
            font-size: 1.1em;
        }
        .problem-card .category, .problem-card p {
            font-size: 0.85em;
        }
        .problem-card .category {
            font-weight: bold;
            color: #6c757d;
            margin-bottom: 8px;
            display: block;
        }
        .problem-card .answer {
            background-color: #eaf5ff;
            border: 1px solid #b8daff;
            padding: 8px;
            border-radius: 4px;
            font-weight: bold;
            color: #004085;
        }
        .problem-card strong {
            color: #495057;
        }

        /* レスポンシブ対応 */
        @media (max-width: 600px) {
            body { padding: 10px; }
            .container { padding: 15px; }
            #formula-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>カード式問題集</h1>
            <p>公式カードをクリックして、関連する問題に絞り込もう！</p>
        </header>

        <section id="formula-container">
            <div id="formula-grid">
                <!-- JavaScriptでカードを動的に生成 -->
            </div>
        </section>

        <section id="problem-container">
            <h2 id="problem-title">問題一覧</h2>
            <div id="problem-display">
                <!-- JavaScriptで問題を動的に表示 -->
            </div>
        </section>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- データ定義 ---

        const formulasData = {
            '力のつり合い': { name: '力のつり合い', formula: 'ΣF = 0', info: '静止、等速直線運動する物体に用いる。', importance: 5, order: 1, keywords: ['つり合い', 'モーメント', '重心', '静止'] },
            'フックの法則': { name: 'フックの法則', formula: 'F = kx', info: 'F:弾性力, k:ばね定数, x:伸び/縮み', importance: 5, order: 2, keywords: ['ばね', 'フック'] },
            '仕事とエネルギー': { name: '仕事とエネルギー', formula: 'W = ΔK + ΔU', info: 'W:仕事, K:運動E, U:位置E', importance: 5, order: 3, keywords: ['仕事', 'エネルギー', '位置エネ'] },
            'オームの法則': { name: 'オームの法則', formula: 'V = IR', info: 'V:電圧, I:電流, R:抵抗', importance: 5, order: 4, keywords: ['オーム', '電気回路', '抵抗', '電圧', '電流'] },
            '抵抗の合成': { name: '抵抗の合成', formula: '直列: R=R₁+R₂', info: '並列: 1/R = 1/R₁+1/R₂ も重要。', importance: 5, order: 5, keywords: ['抵抗', '合成', '電気回路'] },
            '熱力学': { name: '熱力学', formula: 'Q = mcΔT', info: 'Q:熱量, m:質量, c:比熱, ΔT:温度変化', importance: 5, order: 6, keywords: ['熱', '温度', '気化', '融解', '飽和水蒸気量', 'サイクル'] },
            '運動学・グラフ': { name: '運動学・グラフ', formula: 'v-t, x-t グラフ', info: 'グラフの傾きや面積が物理的な意味を持つ。', importance: 4, order: 11, keywords: ['グラフ', '運動'] },
            '波動': { name: '波動', formula: 'v = fλ', info: 'v:速さ, f:振動数, λ:波長。音や光で用いる。', importance: 4, order: 12, keywords: ['波', '共鳴', '音速', '反射', '分散', '散乱'] },
            '円運動・遠心力': { name: '円運動・遠心力', formula: 'F = mv²/r', info: 'F:向心力, m:質量, v:速さ, r:半径', importance: 3, order: 20, keywords: ['円運動', '遠心力', '回転'] },
            '万有引力・重力': { name: '万有引力・重力', formula: 'F = G(Mm/r²)', info: 'G:万有引力定数, M,m:質量, r:距離', importance: 3, order: 21, keywords: ['万有引力', '重力', 'ケプラー'] },
            '電磁気学': { name: '電磁気学', formula: 'F = qvB', info: '磁場中の荷電粒子に働く力(ローレンツ力)。', importance: 3, order: 22, keywords: ['電磁誘導', 'ローレンツ力', 'フレミング', '磁化', 'ホール効果'] },
            '材料力学・構造': { name: '材料力学・構造', formula: '応力・ひずみ', info: '物体の変形や強度に関する分野。', importance: 2, order: 30, keywords: ['応力', '材料', 'トラス', '断面', 'アーチ'] },
            '現代物理・宇宙': { name: '現代物理・宇宙', formula: 'E = mc²', info: '質量とエネルギーの等価性。', importance: 2, order: 31, keywords: ['半減期', '素粒子', 'ハッブル', '宇宙', '対消滅', 'ケプラー'] },
        };

        const problems = [
            // ここに以前の全問題データが入ります（長いため省略）
            { year: 2023, type: 'A', q_num: 1, formulas: ['運動学・グラフ'], content: '図1(速度-時間グラフ)と図2(レースコース図)を見て、時刻0sでのレースカーの位置を①～⑤から選べ。', answer: '② (スタート/ゴールライン)', steps: 'グラフのt=0sの点を探す → v=0に近いことを確認する → コース図で最も速度が遅いスタート地点を選ぶ。', concept: 'レースのスタート時は速度がほぼ0である。v-tグラフの縦軸が速度を表すことから、t=0での速度を読み取り、コース上の位置を特定する。'},
            { year: 2023, type: 'A', q_num: 2, formulas: ['フックの法則', '力のつり合い'], content: '自然長が等しいばね1と2を直列に繋ぎ、ばね1の伸びがばね2の2倍になった。ばね1がばね2を引く力は、ばね2がばね1を引く力の(ア)倍か。ばね1のばね定数は、ばね2の(イ)倍か。', answer: '③ (ア)1, (イ)1/2', steps: '直列接続では力が等しいことを理解する → 各ばねでフックの法則 F=kx を立てる → 2つの式を連立してkの比を求める。', concept: '作用・反作用の法則により直列ばねでは張力が等しくなる。この条件とフックの法則を用いて、伸びの比からばね定数の比を逆算する。'},
            { year: 2023, type: 'A', q_num: 3, formulas: ['円運動・遠心力'], content: '電車の車輪がカーブを曲がる際の回転数の差を吸収できる形状を、断面図の①～④から選べ。', answer: '③', steps: 'カーブで遠心力が働き車輪が外側にずれる → 車輪の半径が接地点で変わる形状を探す → 外側の半径が大きく、内側の半径が小さくなる形状を選ぶ。', concept: 'カーブの内外輪差を吸収するため、車輪の接地面が円錐状になっている。遠心力で車体が外側にずれると、外輪は半径の大きい部分で、内輪は半径の小さい部分でレールに接し、回転差が生まれる。'},
            { year: 2023, type: 'A', q_num: 4, formulas: ['仕事とエネルギー'], content: '長さH、質量mの鎖を、高さHの壁の向こう側へゆっくり移すのに必要な仕事はいくらか。', answer: '③ 3/4 mgH', steps: '鎖の重心の初期位置と最終位置を求める → 重心の移動による位置エネルギーの変化量を計算する → その変化量が人がした仕事に等しいと考える。', concept: '人がした仕事は、物体の位置エネルギーの増加分に等しい。鎖を一つの物体とみなし、その重心がどれだけ上昇したかを計算することがポイント。'},
            { year: 2023, type: 'A', q_num: 5, formulas: ['万有引力・重力', '円運動・遠心力'], content: '緯度と重力加速度の大きさの関係を表すグラフとして最も適当なものを①～④から選べ。', answer: '②', steps: '重力は万有引力と遠心力の合力であると理解する → 遠心力は赤道で最大、極でゼロになる → そのため重力は赤道で最も小さく、高緯度になるほど大きくなるグラフを選ぶ。', concept: '地球は自転しているため、地上にある物体には遠心力が働く。この遠心力は万有引力を打ち消す方向に働くため、緯度によって観測される重力加速度は変化する。'},
            { year: 2023, type: 'A', q_num: 6, formulas: ['熱力学'], content: '湿度が高いと暑く感じる理由とエアコンの除湿機能について、文章の空欄(ア)～(ウ)を埋めよ。', answer: '③ (ア)周りから熱を吸収する (イ)単位体積当たりの水分子の個数が多い (ウ)冷やす', steps: '汗が蒸発する際に気化熱を奪う → 湿度が高いと蒸発しにくい → エアコンは空気を冷やして水蒸気を凝結させる。', concept: '体温調節のメカニズムである「汗の蒸発」が、周囲の空気の湿度によってどれだけ効率的に行われるかを考える。湿度が高いとは、空気中に水蒸気が多く存在し、新たに蒸発する余地が少ない状態である。'},
            { year: 2023, type: 'A', q_num: 7, formulas: ['熱力学'], content: '1kg、1000℃の鉄球を5kg、0℃の氷塊の上に置いたとき、溶ける氷の割合はいくらか。', answer: '① およそ 1/4', steps: '鉄球が失う熱量 Q=mcΔT を計算する → 氷が溶けるのに必要な熱量 Q=mL を使う → 熱量保存則から、溶ける氷の質量mを計算し、割合を求める。', concept: '高温の物体が失った熱エネルギーは、低温の物体が状態変化や温度上昇のために受け取る。この熱量の移動が等しいという「熱量保存則」を用いて立式する。'},
            { year: 2023, type: 'A', q_num: 8, formulas: ['波動'], content: '(1)気柱の長さと振動数の関係グラフを選べ。(2)気温が上がるとそのグラフはどう変化するか選べ。', answer: '① (1)A, (2)ア', steps: '気柱が短いほど音は高くなる(振動数が大きい)関係を選ぶ → 気温が上がると音速が速くなり、同じ長さでもより高い音が出るグラフを選ぶ。', concept: '管楽器の原理である気柱の共鳴では、音の高さ（振動数）は気柱の長さに反比例する。また、音速は媒体の温度に依存し、温度が高いほど速くなる。'},
            { year: 2023, type: 'A', q_num: 9, formulas: ['波動'], content: '直角に置いた2枚の鏡を全体でθ回転させたとき、入射光と同じ向きに入射した光の反射後の向きを①～⑤から選べ。', answer: '③', steps: '直角に置いた鏡では反射光は常に入射光と平行で逆向きになる → 鏡全体を回転させても鏡同士の角度は90度で変わらない → したがって、この関係は維持される。', concept: '直交する2枚の平面鏡（コーナーリフレクタ）に入射した光は、常に元の光と平行な逆向きの経路をたどるという重要な性質がある。系全体を回転させても、内部の相対的な角度関係は変わらない。'},
            { year: 2023, type: 'A', q_num: 10, formulas: ['オームの法則', '抵抗の合成'], content: '電圧計と電流計の接続方法(A),(B)について、文章の空欄(ア)～(エ)を埋めよ。', answer: '③', steps: '電圧計・電流計の内部抵抗による測定誤差を考える → 接続(A)では電圧が、(B)では電流が正確に近い → 測定対象の抵抗値に応じて誤差が小さい方を選ぶ。', concept: '理想的な測定器と異なり、実際の電圧計と電流計は内部抵抗を持つため、回路に接続すること自体が測定値に誤差を生む。どちらの接続方法がより正確かは、測定対象の抵抗と測定器の内部抵抗の大小関係による。'},
            { year: 2023, type: 'A', q_num: 11, formulas: ['電磁気学'], content: 'アルミ斜面を滑り落ちるネオジム磁石に働く渦電流の向きと、銅板に変えた場合の速さの変化について、空欄(ア)～(ウ)を埋めよ。', answer: '⑥', steps: 'レンツの法則から渦電流の向きを判断する → フレミングの左手の法則で力の向きを判断する → 電気伝導率が高いほど渦電流が強く、ブレーキ効果も強くなる（遅くなる）。', concept: '導体中を磁石が動くと、磁場の変化を妨げる向きに渦電流が発生し（電磁誘導）、その結果磁石の動きにブレーキがかかる。この効果の強さは導体の電気伝導率に依存する。'},
            { year: 2023, type: 'A', q_num: 12, formulas: ['オームの法則'], content: '青色LED(順方向電圧3.1V)に5.0Vの電源を接続し10mAの電流を流したい。何Ωの抵抗を直列に接続すればよいか。', answer: '② 190Ω', steps: '抵抗にかかる電圧を求める (5.0V - 3.1V) → オームの法則 V=IR を使い、抵抗値を計算する R = V/I。', concept: '直列回路では、各素子にかかる電圧の和が電源電圧に等しい。LEDの電圧降下分を考慮し、残りの電圧が抵抗器にかかるように設計する。'},
            { year: 2023, type: 'A', q_num: 13, formulas: ['現代物理・宇宙'], content: '(1)放射性同位体が1/64になるには半減期が何回か。(2)岩石の年代測定に関する文章の空欄を埋めよ。', answer: '⑤', steps: '(1) 1/64 = (1/2)⁶ なので6回と判断する → (2) 半減期より非常に短い時間は、崩壊量が時間に比例すると近似できる。', concept: '放射性同位体の崩壊は、確率的な現象であり、その数は指数関数的に減少する。半減期とは、その数が半分になるまでにかかる時間である。'},
            { year: 2023, type: 'A', q_num: 14, formulas: ['現代物理・宇宙'], content: 'PET検査に関する文章の空欄(ア),(イ)を埋めよ。陽電子は(ア)と対消滅し、γ線を放出する。γ線は(イ)という性質を持つ。', answer: '②', steps: '陽電子は電子の反粒子であり、電子と対消滅することを理解する → γ線は電荷を持たない電磁波で、α線やβ線より透過力が高いことを理解する。', concept: '物質と反物質が出会うと、質量がエネルギーに変換される「対消滅」という現象が起きる。PET検査はこの原理を医療に応用したものである。'},
            { year: 2023, type: 'A', q_num: 15, formulas: ['万有引力・重力', '現代物理・宇宙'], content: 'ケプラーの第3法則(T²∝a³)を表すグラフの概形を、両対数グラフではない通常のグラフの①～⑥から選べ。', answer: '④ (両対数グラフで直線になるので、通常のグラフではべき関数となる)', steps: 'ケプラーの第3法則 T² = k a³ を理解する → この関係は、T²がa³に比例する直線関係である → 縦軸T², 横軸a³のグラフで原点を通る直線になるグラフを選ぶ。', concept: 'ケプラーの第3法則は、惑星の公転周期の2乗が軌道長半径の3乗に比例するという法則である。この比例関係を正しくグラフで表現できるかを問う問題。'},
            { year: 2023, type: 'B', q_num: 1, formulas: ['波動'], content: 'マイクとイヤーピースの距離から、ノイズキャンセリング音の遅延時間を求めよ。', answer: '2.9 x 10⁻⁵ s', steps: '音が進む距離の差を求める → その距離を音速で割り、時間差を計算する。', concept: '音の打ち消し合い（干渉）が成立するためには、元の音波と逆位相の音波が鼓膜に同時に到達する必要がある。そのための時間調整を計算する。'},
            { year: 2023, type: 'B', q_num: 2, formulas: ['波動'], content: 'ノイズ波形を打ち消すための逆位相の波形を①～④から選べ。', answer: '④', steps: '元の波形の山と谷を反転させる → 選択肢から上下が逆の波形を選ぶ。', concept: '波の干渉において、波形を打ち消すには振幅が等しく位相がπ(180°)ずれた波を重ね合わせればよい。'},
            { year: 2023, type: 'B', q_num: 3, formulas: ['電磁気学'], content: 'コンデンサーマイクの振動板が動いたときの電気容量・電気量・電流の向きを答えよ。', answer: '⑧', steps: 'dが増加 → C=εS/dからCは減少 → Q=CVからQも減少 → 電荷が流れ出すので電流の向きが決まる。', concept: 'コンデンサーの基本式に基づいて、物理的な変化（極板間距離の変化）が電気的な量（容量、電荷）にどう影響するかを段階的に考える。'},
            { year: 2023, type: 'B', q_num: 4, formulas: ['電磁気学'], content: '問3のとき、抵抗を通過した電気量をd, Δd, Qで表せ。', answer: '(Δd / (d+Δd)) Q', steps: '変化前後の電気量を計算する → その差が抵抗を通過した電気量となる。', concept: '回路内の電荷保存則から、コンデンサーの蓄電電荷の変化分が、接続された抵抗を流れることになる。'},
            { year: 2023, type: 'B', q_num: 5, formulas: ['数式読解'], content: '増幅率 h = kS / (mnSM) を小さくするための正しい方法をすべて選べ。', answer: '②、④', steps: '分数を小さくするには「分子を小さく」かつ「分母を大きく」する → 各選択肢がこの条件を満たすか検討する。', concept: '与えられた数式を目的（この場合は最小化）に合わせて操作する問題。変数が分子にあるか分母にあるかで、増減の方向性が決まる。'},
            { year: 2023, type: 'B', q_num: 6, formulas: ['電磁気学', '波動'], content: 'ドライバーユニット(スピーカー)の働きについて誤っているものをすべて選べ。', answer: '③、⑥', steps: '各選択肢を物理法則と照らし合わせる → ③磁石の極性を逆にすると力の向きが逆になり波形は反転するが音色は変わらない → ⑥フレミングの左手の法則を適用すると力の向きは右向き。', concept: 'スピーカーは電流が磁場から受ける力を利用して音を出す装置である。この基本原理と音の物理的性質（音色、大きさ）に関する知識を元に正誤を判断する。'},
            { year: 2023, type: 'B', q_num: 7, formulas: ['波動'], content: '300Hzのノイズを消した後の音の波形（100Hz+200Hz）を描け。', answer: '解答用紙には100Hzと200Hzの波形を合成した波形が描かれている。', steps: '元の音は100Hz, 200Hz, 300Hzの合成波 → 300Hz成分を消去する → 残った100Hzと200Hzの波を重ね合わせる。', concept: '波の重ね合わせの原理に基づき、複数の正弦波を合成（または特定の成分を除去）した結果の波形をイメージする。'},
            { year: 2024, type: 'A', q_num: 1, formulas: ['力のつり合い'], content: '質量1gのコインA(-2,2)、2gのB(-1,-1)を置いた板が水平を保つには、2gのコインCをどの座標に置けばよいか。', answer: '② (2, 0)', steps: '全体の重心が原点(0,0)になる条件を考える → x座標について: (1×(-2) + 2×(-1) + 2×x) / (1+2+2) = 0 を解く → y座標について同様に解く。', concept: '複数の物体からなる系が一点で支えられて釣り合うためには、系全体の重心がその支点の真上（または真下）になければならない。'},
            { year: 2024, type: 'A', q_num: 2, formulas: ['力のつり合い', '材料力学・構造'], content: '2つの剛体を糸で繋いだテンセグリティ構造(a),(b)について、成立する(a)としない(b)の理由を説明する文章の空欄(ア)～(エ)を埋めよ。', answer: '⑤', steps: '剛体1の重心を回転の中心とする → (a)では2本の糸が作るモーメントが逆向きでつり合う → (b)では2本の糸が作るモーメントが同じ向きでつり合わない。', concept: '物体が回転せずに静止するためには、時計回りのモーメントの合計と反時計回りのモーメントの合計が等しい必要がある。'},
            { year: 2024, type: 'A', q_num: 3, formulas: ['材料力学・構造'], content: 'クリアファイルの底にある「裂け止め」の形状として、力を分散させ、裂けにくくするのに適したものを①～④から選べ。', answer: '③', steps: '角が尖っていると応力が集中しやすい → 力を分散させるには、角が滑らかな曲線であるべき → 選択肢から根元が丸みを帯びた形状を選ぶ。', concept: '材料の破壊は、応力が集中する箇所から始まることが多い。切り欠きの先端を丸くすることで応力集中を緩和し、強度を高めることができる。'},
            { year: 2024, type: 'A', q_num: 4, formulas: ['材料力学・構造'], content: '自転車を掛けてたわんだ横棒に穴を開ける場合、強度への影響が最も少ない位置はA(上部)、B(まん中)、C(下部)のどこか。', answer: '② B(まん中)', steps: '棒がたわむと上部は圧縮、下部は引張の力が働く → その中間にあたる中心部（中立軸）は変形が最も小さい → 強度への影響が最も少ないのは中心部。', concept: '梁（はり）が曲げられるとき、断面内には引張応力と圧縮応力が分布するが、その間には応力がゼロになる中立軸が存在する。材料を削るならこの位置が最も影響が少ない。'},
            { year: 2024, type: 'A', q_num: 5, formulas: ['熱力学', '波動'], content: '浮沈子の実験について、(1)側面を押したときの圧力変化が大きいのはA,Bどちらか。(2)沈みやすいペットボトルの形状はア,イどちらか。', answer: '②', steps: '(1)空気の体積が小さいAの方が体積変化率が大きく、圧力変化も大きい → (2)力を効率よく水圧に変換できるずんぐりした形状の方が沈みやすい。', concept: '浮沈子の動作原理は、外部からの圧力変化が浮沈子内部の空気の体積を変化させ、それによって浮力が変わることによる。'},
            { year: 2024, type: 'A', q_num: 6, formulas: ['波動'], content: '夕焼けの実験とミー散乱に関する文章の空欄(ア)～(ウ)を埋めよ。', answer: '⑥', steps: 'レイリー散乱では波長の短い光が散乱されやすく、長い光は透過しやすい → 全ての波長の光が混ざると白色光になる → ミー散乱を起こす大きな粒子が少ないと空気が澄む。', concept: '光の散乱には、粒子の大きさと光の波長の大小関係によって種類が異なる。夕焼けの赤はレイリー散乱、雲の白はミー散乱によるものである。'},
            { year: 2024, type: 'A', q_num: 7, formulas: ['波動'], content: '主虹と副虹、および赤色光の進み方について、正しい組み合わせを①～⑧から選べ。', answer: '⑤', steps: '主虹は反射1回、副虹は反射2回 → 赤色光は紫色光より屈折角が小さい（曲がりにくい）→ 図から光の経路を正しくたどる。', concept: '虹ができる原理は、水滴内での光の分散と反射である。主虹と副虹では反射回数が異なり、それによって見える角度や色の順番が変わる。'},
            { year: 2024, type: 'A', q_num: 8, formulas: ['波動'], content: '水を満たした円筒形ペットボトルを通して50cm先の三角形を見たときの像の見え方と種類を①～⑧から選べ。', answer: '⑦', steps: '円筒は水平方向にはレンズ効果がなく、垂直方向にのみ凸レンズとして働く → 上下のみが反転した実像が見えると判断する。', concept: '円筒レンズは一方向にしか屈折作用を持たない。そのため、像は一方向のみに変化（この場合は倒立）する。'},
            { year: 2024, type: 'A', q_num: 9, formulas: ['熱力学'], content: '冬の朝、ステンレス製の手すりに積もった雪が溶けかけた様子として最も適当なものを①～⑤から選べ。', answer: '④', steps: 'ステンレスは熱伝導率が高い → 手すりの支柱は比較的温度が高い地面や壁に接続されている → 支柱から熱が伝わり、その周辺の雪から溶け始める。', concept: '物質内の熱の伝わりやすさを熱伝導という。熱は温度の高い方から低い方へ伝わるため、手すりの熱源がどこにあるかを考えることが鍵となる。'},
            { year: 2024, type: 'A', q_num: 10, formulas: ['熱力学'], content: 'パルスジェットエンジンの動作サイクルについて、文章の空欄(ア)～(エ)を埋めよ。', answer: '③', steps: '爆発で圧力上昇 → 高圧ガスを排気 → 内部の圧力が低下 → 外から新鮮な空気を吸引、というサイクルを組み立てる。', concept: '内燃機関は「吸気・圧縮・燃焼・排気」のサイクルを繰り返すことで動力を得る。この基本的な流れを理解し、問題文の空欄を埋める。'},
            { year: 2024, type: 'A', q_num: 11, formulas: ['抵抗の合成'], content: '図2の回路(2)の合成抵抗は、回路(1)の何倍か。', answer: '① 1倍', steps: '回路(1)の合成抵抗を求める(2R) → 回路(2)の合成抵抗を求める(複雑な並列・直列を順に計算すると2R) → 倍率を計算する。', concept: '複雑な回路の合成抵抗は、単純な部分回路（直列や並列）に分解して、段階的に計算していく。'},
            { year: 2024, type: 'A', q_num: 12, formulas: ['電磁気学'], content: 'ホール素子にN極を近づけたときのキャリアと正に帯電する面の組み合わせを①～④から選べ。', answer: '③', steps: '電流の向き(キャリアの動く向き)と磁場の向きからローレンツ力の向きを判断する → キャリアが正孔(+)か電子(-)かで、どちらの面に集まるか、どちらの面が正になるかを判断する。', concept: 'ホール効果は、磁場中の導体を流れる荷電粒子（キャリア）がローレンツ力を受けて偏ることで電圧が生じる現象。キャリアの電荷の符号によって電圧の向きが変わる。'},
            { year: 2024, type: 'A', q_num: 13, formulas: ['電磁気学'], content: 'U字磁石とクリップの間に鉄板を挿入した場合のクリップの様子について、正しい組み合わせを①～④から選べ。', answer: '③', steps: '鉄板は磁力線を引き寄せる性質がある → N極とS極の間に鉄板を入れると、磁力線は鉄板の中を通り、クリップのある外部空間の磁場は弱まる（磁気遮蔽） → クリップは落下する。', concept: '強磁性体である鉄は、外部の磁場を内部に引き込み、外部の磁場を弱める「磁気遮蔽」の効果を持つ。'},
            { year: 2024, type: 'A', q_num: 14, formulas: ['幾何学', '三角比'], content: '北緯45°から北緯60°の上空に見えるオーロラの高度hを求めよ。地球半径R=6400km, cos15°=0.97。', answer: '③ 200km', steps: '地球中心O、観測点A、オーロラ直下のB、オーロラCで三角形OACを考える → 正弦定理 R/sin(∠OCA) = (R+h)/sin(∠OAC) を適用してhを解く。', concept: '問題文の状況を幾何学的な図形として描き出し、三角形の辺と角の関係を表す定理（正弦定理や余弦定理）を適用して未知の量を求める。'},
            { year: 2024, type: 'A', q_num: 15, formulas: ['現代物理・宇宙'], content: '1秒の誤差が生じるのに300億年かかる光格子時計の精度を、時間スケールの比較から選べ。', answer: '⑨ 約300億年 (宇宙が誕生してから遥か未来まで)', steps: '光格子時計の精度が極めて高いことを理解する → 選択肢の時間スケールを比較する → 宇宙の年齢(138億年)よりも長いスケールであると判断する。', concept: '科学技術の進歩を時間的なスケール感で捉える問題。最新技術が達成した精度が、人類史や地球史、宇宙史といった巨大な時間スケールの中でどの程度に位置するかを考察する。'},
            { year: 2024, type: 'B', q_num: 1, formulas: ['力のつり合い'], content: '重さ200Nの荷物を2本のひもで左右対称(各60°)に支える。Bがひもを引く力の大きさはいくらか。また、AはなぜBを引っ張る必要があるのか。', answer: '力の大きさ: 200N, 説明: Bが荷物から右に引っ張られるので左向きに力を加えて支えるため。', steps: '力の鉛直成分のつり合いを考える → Bの力の大きさを求める → 水平方向の力のつり合いを考える。', concept: '物体が静止している状態では、全ての力がベクトル的に釣り合っている。力を垂直成分と水平成分に分解して、それぞれの方向でつり合いの式を立てる。'},
            { year: 2024, type: 'B', q_num: 2, formulas: ['幾何学', '三角比'], content: '海面での間隔1100m、地球半径6400kmの2本の塔がある。高さ186mの最上部での間隔の広がりは何mmか。', answer: '32 mm', steps: '地球中心を頂点とする2つの扇形を考える → 相似比 (R+h)/R を計算する → 海面での間隔に相似比を掛け、元の間隔との差を求める。', concept: '地球が球体であることを考慮すると、地上に鉛直に立てた構造物は上部ほど間隔が広がる。この関係は、地球中心を頂点とする扇形の相似でモデル化できる。'},
            { year: 2024, type: 'B', q_num: 3, formulas: ['材料力学・構造'], content: '同じだけたわむのに必要なおもりの数を求めよ。(ア)幅・厚み2倍、(イ)幅・厚み3倍の場合。', answer: '(ア) 8個 (イ) 27個', steps: '曲げへの強さは断面係数W=bh²/6に比例すると考える → Wはbに比例しh²に比例するので、幅・厚みがN倍になると強さはN³倍になる → よっておもりの数もN³倍必要になる。', concept: '梁の曲げにくさ（曲げ剛性）は断面の形状に大きく依存する。断面係数の式から、寸法が変化したときに強度がどのように変わるかを定量的に評価する。'},
            { year: 2024, type: 'B', q_num: 4, formulas: ['材料力学・構造'], content: 'トラス橋が自重で受ける圧縮力と引張力の分布として正しいものを①～④から選べ。', answer: '②', steps: '橋全体が下にたわもうとする → 上弦材は圧縮、下弦材は引張 → 斜材と垂直材は荷重を伝達するように交互に圧縮・引張を受ける。', concept: 'トラス構造では、各部材が軸方向の力（引張または圧縮）のみを受けるように設計されている。橋全体にかかる荷重が各部材にどのように分散されるかを考える。'},
            { year: 2024, type: 'B', q_num: 5, formulas: ['幾何学'], content: '3つの同じ台形を組み合わせてアーチを作る。台形の角度θはいくらか。', answer: '30°', steps: '3つの台形で半円(180°)のアーチを構成すると考える → 1つの台形が作る中心角は180°/3=60° → 幾何学的関係からθを求める。', concept: '安定したアーチ構造は、各部材が互いに支え合うことで成立する。この幾何学的な拘束条件から、各部材の角度を決定できる。'},
            { year: 2024, type: 'B', q_num: 6, formulas: ['力のつり合い', '材料力学・構造'], content: 'アーチを構成する台形に働く垂直抗力を求めよ。', answer: '(N₁) W/3 (N) W/2', steps: '各台形に働く力のつり合いを考える。上の台形からN₁を求め、下の台形でNを求める。', concept: '静力学の基本。構造物を構成する各要素に着目し、それぞれに働く力が釣り合っているという条件から未知の力を求める。'},
            { year: 2024, type: 'B', q_num: 7, formulas: ['力のつり合い', '材料力学・構造'], content: '12個の台形からなるアーチ橋で、床からの垂直抗力Nを求めよ。', answer: 'W/2', steps: 'アーチ橋全体を一つの物体とみなす → 全体の重力Wと、左右の床からの垂直抗力2Nがつり合う → 対称性から片側はW/2。', concept: '系全体で外力が釣り合うという考え方は、複雑な内部力を考慮せずに反力を求める際に非常に有効である。'},
            { year: 2024, type: 'B', q_num: 8, formulas: ['力のつり合い'], content: 'アーチの微小区間に働く力のつり合いの式を完成させよ。', answer: '① (N+dN)cosφ = Ncosφ ② (N+dN)sinφ = Nsinφ + wdx', steps: '微小区間に働く力を水平成分と鉛直成分に分解する → それぞれの方向で力の総和が0になる式を立てる。', concept: '連続体の力学を扱う基本的な手法。全体を微小な部分に分割し、その部分での力のつり合いを考えることで、全体の挙動を記述する微分方程式を導く。'},
            { year: 2024, type: 'B', q_num: 9, formulas: ['材料力学・構造'], content: '単位長さあたりの荷重wが均等にかかり、曲げが生じないアーチの形状を表す式をx, y, f, Lで示せ。', answer: 'y = (4f/L²)(Lx - x²)', steps: 'コラムの解説から、理想的なアーチの形状が放物線で与えられることを理解する → 境界条件(x=0,Lでy=0; x=L/2でy=f)を満たす放物線の式を立てる。', concept: '自然界や構造物における理想的な形状は、しばしば単純な数学関数で記述できる。物理的な条件（荷重が均等、曲げモーメントがゼロ）を数学的な方程式に変換し、それを解くことで形状を決定する。'},
            { year: 2024, type: 'B', q_num: 10, formulas: ['三角比'], content: '地球から見て月と太陽が87°離れているとき、太陽は月より何倍遠いか。cos87°≒0.052とする。', answer: '19倍', steps: '地球、月、太陽が作る直角三角形を考える → cos87° = (地球-月 距離) / (地球-太陽 距離) の関係式を立てる → 距離の比を計算する 1 / 0.052 ≒ 19。', concept: '古代ギリシャで行われたような、天体の配置を単純な幾何学モデルに落とし込み、三角比を用いて未知の距離を推定する手法を再現する。'},
            { year: 2024, type: 'B', q_num: 11, formulas: ['現代物理・宇宙'], content: 'ハッブルの測定結果(グラフ)から、宇宙の誕生が約何億年前かを求めよ。', answer: '20億年前', steps: 'グラフの傾き(ハッブル定数 H₀)を読み取る → 宇宙年齢 T ≒ 1/H₀ を計算する → 単位を年に変換する。', concept: '宇宙が一様膨張していると仮定すると、その膨張率（ハッブル定数）の逆数が、膨張が始まってからの時間（宇宙年齢）に相当する。'},
            { year: 2024, type: 'B', q_num: 12, formulas: ['運動学・グラフ', '地球科学'], content: '宇宙望遠鏡で観測する理由として最も適切なものを①～④から選べ。', answer: '① 宇宙から観測すると大気の揺らぎの影響を受けないので、高い解像度で観測できるため。', steps: '地上での観測の限界を考える → 大気の揺らぎ(シーイング)が解像度を低下させる最大の要因である → 宇宙空間ではこの影響がない。', concept: '地上と宇宙の観測環境の最大の違いは「大気の有無」である。大気が天体観測に与える様々な悪影響（揺らぎ、吸収、天候）がなくなることが宇宙望遠鏡の最大の利点である。'},
        ];


        // --- DOM要素 ---
        const formulaGrid = document.getElementById('formula-grid');
        const problemDisplayContainer = document.getElementById('problem-display');
        const problemTitle = document.getElementById('problem-title');
        let activeFormulaName = 'all';

        // --- 関数定義 ---

        // 星を生成する関数
        const generateStars = (importance) => {
            let starsHTML = '';
            for (let i = 1; i <= 5; i++) {
                starsHTML += (i <= importance) ? '★' : '<span class="dim">★</span>';
            }
            return starsHTML;
        };

        // カードを生成・表示する関数
        const createFormulaCards = () => {
            // "すべて表示" カードを先頭に追加
            const allCard = document.createElement('div');
            allCard.className = 'formula-card active';
            allCard.dataset.formulaName = 'all';
            allCard.innerHTML = `
                <div class="card-content">
                    <div class="formula-display">📚</div>
                    <div class="formula-info">すべての問題を表示します</div>
                </div>
                <div class="card-footer">すべて表示</div>
            `;
            formulaGrid.appendChild(allCard);

            const sortedFormulaKeys = Object.keys(formulasData).sort((a, b) => {
                const dataA = formulasData[a];
                const dataB = formulasData[b];
                if (dataB.importance !== dataA.importance) {
                    return dataB.importance - dataA.importance; // 重要度で降順
                }
                return dataA.order - dataB.order; // 学習順で昇順
            });

            sortedFormulaKeys.forEach(key => {
                const data = formulasData[key];
                const card = document.createElement('div');
                card.className = 'formula-card';
                card.dataset.formulaName = data.name;

                card.innerHTML = `
                    <div class="card-content">
                        <div class="stars">${generateStars(data.importance)}</div>
                        <div class="formula-display">${data.formula}</div>
                        <div class="formula-info">${data.info}</div>
                    </div>
                    <div class="card-footer">${data.name}</div>
                `;
                formulaGrid.appendChild(card);
            });
        };

        // 問題を表示する関数
        const displayProblems = (filterName) => {
            problemDisplayContainer.innerHTML = '';
            activeFormulaName = filterName;
            
            let filteredProblems;
            if (filterName === 'all') {
                filteredProblems = problems;
            } else {
                const filterData = Object.values(formulasData).find(f => f.name === filterName);
                if (filterData && filterData.keywords) {
                    filteredProblems = problems.filter(p => 
                        p.formulas.some(pf => 
                            filterData.keywords.some(kw => pf.includes(kw))
                        )
                    );
                } else {
                    filteredProblems = problems.filter(p => p.formulas.includes(filterName));
                }
            }
            
            // タイトルの更新
            const titleName = filterName === 'all' ? 'すべて' : filterName;
            problemTitle.textContent = `「${titleName}」関連の問題 (${filteredProblems.length}問)`;
            
            if (filteredProblems.length === 0) {
                problemDisplayContainer.innerHTML = '<p>該当する問題はありません。</p>';
                return;
            }

            // 問題をソートして表示
            filteredProblems.sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                if (a.type !== b.type) return a.type.localeCompare(b.type);
                return a.q_num - b.q_num;
            }).forEach(p => {
                const card = document.createElement('div');
                card.classList.add('problem-card');
                card.innerHTML = `
                    <h3>${p.year}年 問題${p.type} 第${p.q_num}問</h3>
                    <span class="category">関連公式・分野: ${p.formulas.join(', ')}</span>
                    <p><strong>問題内容:</strong> ${p.content}</p>
                    <p class="answer"><strong>模範解答:</strong> ${p.answer}</p>
                    <p><strong>求める手順:</strong> ${p.steps}</p>
                    <p><strong>考え方:</strong> ${p.concept}</p>
                `;
                problemDisplayContainer.appendChild(card);
            });
            updateActiveCard();
        };

        // アクティブなカードをハイライトする関数
        const updateActiveCard = () => {
            const cards = document.querySelectorAll('.formula-card');
            cards.forEach(card => {
                if (card.dataset.formulaName === activeFormulaName || (activeFormulaName === 'all' && card.dataset.formulaName === 'all')) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
        };
        

        // --- イベントリスナー ---

        formulaGrid.addEventListener('click', (e) => {
            const card = e.target.closest('.formula-card');
            if (card) {
                const formulaName = card.dataset.formulaName;
                displayProblems(formulaName);
            }
        });

        // --- 初期化 ---
        createFormulaCards();
        displayProblems('all'); 
    });
    </script>
</body>
</html>
